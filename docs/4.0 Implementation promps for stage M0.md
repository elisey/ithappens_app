# Серия промптов для фазы M0: Бутстрап и качество

## Контекст для всей серии

Мы создаем PWA приложение "ithappens" для чтения историй с офлайн-доступом. Это первая фаза разработки, где мы настраиваем проектную инфраструктуру. Каждый промпт строится на результатах предыдущего, обеспечивая непрерывную интеграцию кода.

---

## Prompt M0.1: Скелет Vite + Preact + TypeScript

```text
Создай базовую структуру проекта PWA приложения "ithappens" используя Vite, Preact и TypeScript.

## Требования:
1. Инициализируй новый проект с Vite, используя Preact template с TypeScript
2. Создай базовую структуру папок согласно архитектуре:
   - src/components/
   - src/services/
   - src/utils/
   - src/types/
   - src/data/
   - public/
3. Создай минимальный App компонент, который отображает заголовок "ithappens" и текст "Загрузка приложения..."
4. Настрой tsconfig.json с strict режимом и путями импорта (@/ для src/)
5. Обнови package.json с правильным названием проекта и описанием

## Структура файлов для создания:
- package.json (с необходимыми зависимостями)
- tsconfig.json (с strict конфигурацией)
- vite.config.ts (с алиасами путей)
- src/main.tsx (точка входа)
- src/app.tsx (главный компонент)
- src/app.module.css (базовые стили)
- src/vite-env.d.ts (типы для Vite)
- index.html (с правильным title и meta тегами)
- .gitignore

## Тесты для проверки:
- Команда `npm run dev` должна запускать dev сервер
- Приложение должно отображать текст "ithappens" и "Загрузка приложения..."
- TypeScript компиляция должна проходить без ошибок

## Критерий готовности:
Dev сервер запускается, отображается стартовая страница с текстом, нет ошибок TypeScript.

Выведи полный код всех файлов с комментариями на ключевых местах.
```

---

## Prompt M0.2: ESLint + Prettier конфигурация

```text
Добавь в существующий проект "ithappens" настройку ESLint и Prettier для обеспечения качества кода.

## Контекст:
У нас уже есть базовый проект на Vite + Preact + TypeScript из предыдущего шага.

## Требования:
1. Установи и настрой ESLint с поддержкой:
   - TypeScript (через @typescript-eslint)
   - Preact/React hooks правил
   - Import сортировки
2. Установи и настрой Prettier с:
   - Одинарными кавычками
   - Без точки с запятой в конце
   - Шириной строки 100 символов
   - Trailing comma для многострочных структур
3. Настрой интеграцию ESLint с Prettier (eslint-config-prettier)
4. Создай .editorconfig для консистентности
5. Добавь npm скрипты для линтинга и форматирования

## Файлы для создания/обновления:
- .eslintrc.json (конфигурация ESLint)
- .prettierrc (конфигурация Prettier)
- .prettierignore (игнорируемые файлы)
- .editorconfig (настройки редактора)
- package.json (обновить scripts и devDependencies)

## Исправления в существующем коде:
- Примени форматирование к src/app.tsx
- Примени форматирование к src/main.tsx
- Исправь любые ESLint предупреждения

## Тесты для проверки:
- `npm run lint` должен проходить без ошибок
- `npm run format:check` должен показывать, что все файлы отформатированы
- `npm run format` должен форматировать все файлы

## Критерий готовности:
Команды lint и format работают, существующий код соответствует правилам.

Выведи полную конфигурацию и обновленный код файлов.
```

---

## Prompt M0.3: Настройка тестирования Vitest

```text
Добавь в проект "ithappens" настройку тестирования с Vitest и @testing-library/preact.

## Контекст:
Проект уже имеет Vite + Preact + TypeScript + ESLint + Prettier из предыдущих шагов.

## Требования:
1. Установи и настрой Vitest с:
   - Поддержкой TypeScript
   - Coverage репортами (c8)
   - jsdom окружением для тестов компонентов
2. Установи @testing-library/preact и необходимые утилиты
3. Настрой пути импорта для тестов (те же алиасы что в vite.config.ts)
4. Создай пробный тест для App компонента
5. Создай setup файл для тестов с базовыми настройками
6. Добавь npm скрипты для тестирования

## Файлы для создания/обновления:
- vitest.config.ts (конфигурация Vitest)
- src/tests/setup.ts (настройка тестового окружения)
- src/app.test.tsx (тест для App компонента)
- package.json (обновить scripts и devDependencies)

## Пробный тест должен проверять:
- Компонент App рендерится без ошибок
- Отображается текст "ithappens"
- Отображается текст "Загрузка приложения..."

## Тесты для проверки:
- `npm run test` запускает тесты и они проходят
- `npm run test:coverage` генерирует coverage отчет
- Coverage показывает покрытие для app.tsx

## Критерий готовности:
Тесты запускаются, пробный тест зеленый, coverage репорт генерируется.

Выведи полную конфигурацию и код тестов с пояснениями.
```

---

## Prompt M0.4: Taskfile для автоматизации

```text
Создай Taskfile.yml для автоматизации команд разработки в проекте "ithappens".

## Контекст:
Проект имеет настроенные Vite, ESLint, Prettier, Vitest из предыдущих шагов.

## Требования:
1. Установи Task (taskfile.dev) как инструмент автоматизации
2. Создай Taskfile.yml с командами:
   - dev: запуск dev сервера
   - build: production сборка
   - preview: предпросмотр production сборки
   - test: запуск тестов
   - test:watch: тесты в watch режиме
   - test:coverage: тесты с coverage
   - lint: проверка ESLint
   - format: форматирование Prettier
   - format:check: проверка форматирования
   - check: комбинация lint + format:check + test
   - clean: очистка сгенерированных файлов
3. Добавь описания для каждой команды
4. Настрой зависимости между командами где необходимо
5. Обнови README.md с инструкциями по использованию Task

## Файлы для создания/обновления:
- Taskfile.yml (конфигурация всех команд)
- README.md (документация по командам)
- package.json (добавить скрипт для установки task если нужно)

## Особенности:
- Команда check должна прерываться при первой ошибке
- Команда build должна сначала выполнять check
- Используй переменные для путей где возможно

## Тесты для проверки:
- `task dev` запускает dev сервер
- `task test` запускает тесты
- `task check` выполняет полную проверку
- `task build` создает production сборку

## Критерий готовности:
Все task команды работают корректно, документация обновлена.

Выведи полный Taskfile.yml с комментариями и обновленный README.md.
```

---

## Prompt M0.5: Git hooks для качества кода

```text
Настрой Git hooks для автоматической проверки качества кода перед коммитом в проекте "ithappens".

## Контекст:
Проект имеет полную настройку инструментов разработки и Taskfile из предыдущих шагов.

## Требования:
1. Установи lefthook для управления git hooks
2. Настрой pre-commit hook который:
   - Проверяет форматирование только для staged файлов
   - Запускает ESLint только для staged файлов
   - Запускает тесты связанные с измененными файлами
3. Настрой commit-msg hook для проверки формата сообщений коммита
4. Добавь возможность пропуска hooks при необходимости (--no-verify)
5. Документируй процесс в README.md

## Файлы для создания/обновления:
- lefthook.yml (конфигурация hooks)
- .lefthookrc (локальные настройки, добавить в .gitignore)
- package.json (добавить lefthook в devDependencies и postinstall)
- README.md (добавить раздел про git hooks)

## Формат коммитов:
- feat: новая функциональность
- fix: исправление бага
- docs: изменения документации
- style: форматирование кода
- refactor: рефакторинг
- test: добавление тестов
- chore: обновление зависимостей и настроек

## Тесты для проверки:
1. Создай тестовый файл с ошибкой форматирования
2. Попробуй закоммитить - должен быть отказ
3. Исправь форматирование
4. Коммит должен пройти с правильным сообщением
5. Коммит с неправильным форматом сообщения должен быть отклонен

## Критерий готовности:
Pre-commit hook работает, проверяет только staged файлы, commit-msg проверяет формат.

Выведи полную конфигурацию lefthook и обновления других файлов.
```

---

## Финальная проверка интеграции M0

```text
Проверь полную интеграцию всех настроек фазы M0 в проекте "ithappens".

## Контекст:
Мы завершили настройку:
- Vite + Preact + TypeScript (M0.1)
- ESLint + Prettier (M0.2)
- Vitest + Testing Library (M0.3)
- Taskfile автоматизация (M0.4)
- Git hooks через lefthook (M0.5)

## Задачи проверки:
1. Выполни полную проверку через `task check`
2. Создай тестовый компонент HelloWorld в src/components/
3. Напиши тест для этого компонента
4. Убедись что все инструменты работают вместе
5. Сделай тестовый коммит с этим компонентом

## Тестовый компонент должен:
- Принимать prop "name"
- Отображать "Hello, {name}!"
- Иметь стили через CSS Modules
- Иметь 100% test coverage

## Финальная структура проекта:
Покажи дерево файлов проекта после всех настроек.

## Чеклист готовности фазы M0:
- [ ] Dev сервер запускается без ошибок
- [ ] ESLint и Prettier настроены и работают
- [ ] Тесты запускаются и проходят
- [ ] Coverage репорты генерируются
- [ ] Все task команды работают
- [ ] Git hooks проверяют код перед коммитом
- [ ] Документация в README.md актуальна

## Критерий завершения фазы:
Вся инфраструктура настроена, можно переходить к разработке функциональности.

Выведи код тестового компонента, его тест и результаты всех проверок.
```

---

## Метаданные для следующей фазы

После успешного завершения фазы M0, следующая серия промптов (M1: Каркас UI) будет строиться на этой основе, используя:
- Установленную систему компонентов с CSS Modules
- Настроенное тестирование для каждого нового компонента
- Автоматические проверки качества через task и git hooks
- TypeScript типизацию для всех новых сущностей

Каждый новый промпт будет ссылаться на установленные паттерны и требовать тестов перед переходом к следующему шагу.