# Серия промптов для фазы M1: Каркас UI

## Контекст для всей серии

Мы продолжаем разработку PWA приложения "ithappens". Фаза M0 завершена - у нас настроена полная инфраструктура с Vite, Preact, TypeScript, тестированием и автоматизацией. Теперь создаем базовый UI каркас приложения с тремя зонами и навигационными элементами.

---

## Prompt M1.1: Разметка трёх зон с семантическими ролями

```text
Создай базовую структуру UI для приложения "ithappens" с тремя основными зонами.

## Контекст:
Проект настроен в фазе M0. Есть App.tsx, тестирование, CSS Modules. Нужно создать responsive layout для мобильных устройств.

## Требования к структуре:
1. Создай компонент Layout с тремя зонами:
   - Header (фиксированный сверху) - для отображения ID истории
   - Content (scrollable середина) - для текста истории
   - Footer (фиксированный снизу) - для навигационных кнопок
2. Используй семантические HTML5 теги (header, main, footer)
3. Добавь ARIA роли для доступности
4. Реализуй CSS Grid или Flexbox layout
5. Обеспечь правильную высоту для мобильных устройств (100vh с учетом safe area)

## Файлы для создания/обновления:
- src/components/Layout/Layout.tsx
- src/components/Layout/Layout.module.css
- src/components/Layout/index.ts (re-export)
- src/app.tsx (интеграция Layout)
- src/app.module.css (обновить стили)
- src/types/common.ts (базовые типы если нужны)

## CSS требования:
- Мобильный-first подход
- Поддержка safe-area-inset для iPhone
- Header и Footer фиксированной высоты
- Content занимает оставшееся пространство с прокруткой
- Минимальная высота экрана 100vh

## Структура компонента Layout:
```tsx
interface LayoutProps {
  header: ComponentChildren
  children: ComponentChildren  // content
  footer: ComponentChildren
}
```

## Тесты для создания:
- src/components/Layout/Layout.test.tsx:
  - Рендерит три зоны
  - Применяет правильные семантические теги
  - Передает children в соответствующие зоны
  - Имеет правильные ARIA роли

## Проверка:
- `task test` - все тесты проходят
- `task dev` - визуально видны три зоны
- Проверка в DevTools на мобильном viewport
- Проверка доступности через axe DevTools

## Критерий готовности:
Три зоны отображаются корректно, фиксированные header/footer, scrollable content, тесты зеленые.

Выведи полный код компонента, стилей и тестов с комментариями.
```

---

## Prompt M1.2: Кнопки навигации без логики

```text
Добавь навигационные кнопки в footer зону приложения "ithappens".

## Контекст:
У нас есть Layout компонент из M1.1 с тремя зонами. Нужно создать компонент Navigation с кнопками.

## Требования:
1. Создай компонент Navigation с тремя кнопками:
   - "Назад" (стрелка влево или текст)
   - "ID" (для открытия модального окна)
   - "Вперед" (стрелка вправо или текст)
2. Добавь prop-функции для обработчиков кликов (пока пустые)
3. Реализуй disabled состояния для кнопок
4. Обеспечь доступность (ARIA labels, роли)
5. Стилизуй кнопки для мобильных устройств (большие touch targets)

## Файлы для создания/обновления:
- src/components/Navigation/Navigation.tsx
- src/components/Navigation/Navigation.module.css
- src/components/Navigation/Navigation.test.tsx
- src/components/Navigation/index.ts
- src/app.tsx (добавить Navigation в Layout)
- src/types/navigation.ts (типы для навигации)

## Интерфейс компонента:
```tsx
interface NavigationProps {
  onPrevious: () => void
  onNext: () => void
  onJump: () => void
  canGoPrevious?: boolean
  canGoNext?: boolean
  currentId?: number
}
```

## CSS требования:
- Кнопки занимают равную ширину (flex: 1)
- Минимальная высота 48px (touch target)
- Визуальные состояния: normal, hover, active, disabled
- Отступы между кнопками
- Контрастность для доступности

## Тесты:
- Рендерит три кнопки
- Вызывает правильные обработчики при клике
- Disabled состояние блокирует клики
- Правильные ARIA атрибуты
- Кнопки доступны по role="button"

## Временные заглушки в App:
```tsx
const handlePrevious = () => console.log('Previous')
const handleNext = () => console.log('Next')  
const handleJump = () => console.log('Jump to ID')
```

## Проверка:
- `task test` - новые тесты проходят
- `task dev` - кнопки отображаются и кликаются
- Console.log срабатывает при кликах
- Кнопки хорошо выглядят на мобильном

## Критерий готовности:
Три кнопки в footer, обработчики работают, disabled состояния, тесты проходят.

Выведи код компонента Navigation, стили, тесты и обновленный App.tsx.
```

---

## Prompt M1.3: CSS Modules базовая типографика и отступы

```text
Настрой базовую типографику и систему отступов для приложения "ithappens".

## Контекст:
У нас есть Layout и Navigation компоненты. Нужна единая система стилей для читаемости на мобильных.

## Требования:
1. Создай глобальные CSS переменные для:
   - Типографики (размеры, line-height, семейства шрифтов)
   - Отступов (spacing scale: 4, 8, 12, 16, 24, 32px)
   - Цветов (подготовка для светлой/темной темы)
   - Размеров компонентов (высота header/footer)
2. Настрой базовые стили для текста истории
3. Добавь CSS reset/normalize
4. Создай утилитарные классы через CSS Modules
5. Обнови существующие компоненты для использования переменных

## Файлы для создания/обновления:
- src/styles/variables.css (CSS custom properties)
- src/styles/reset.css (современный CSS reset)
- src/styles/typography.css (базовые стили текста)
- src/styles/utilities.module.css (переиспользуемые классы)
- src/main.tsx (импорт глобальных стилей)
- src/components/Layout/Layout.module.css (использовать переменные)
- src/components/Navigation/Navigation.module.css (использовать переменные)

## CSS переменные:
```css
:root {
  /* Typography */
  --font-family-base: system-ui, -apple-system, sans-serif;
  --font-size-base: 16px;
  --font-size-large: 18px;
  --line-height-base: 1.6;
  --line-height-compact: 1.4;
  
  /* Spacing */
  --space-xs: 4px;
  --space-sm: 8px;
  --space-md: 16px;
  --space-lg: 24px;
  --space-xl: 32px;
  
  /* Components */
  --header-height: 56px;
  --footer-height: 64px;
  --button-height: 48px;
  
  /* Colors (preparation for theming) */
  --color-background: #ffffff;
  --color-text: #333333;
  --color-text-secondary: #666666;
  --color-border: #e0e0e0;
  --color-button-bg: #f0f0f0;
  --color-button-text: #333333;
  --color-button-disabled: #cccccc;
}
```

## Требования к читаемости:
- Оптимальная длина строки (max-width для текста)
- Достаточные отступы для параграфов
- Контраст текста минимум 4.5:1
- Размер шрифта минимум 16px для основного текста

## Создай компонент-заглушку StoryContent:
- src/components/StoryContent/StoryContent.tsx
- Отображает примерный текст истории с параграфами
- Использует новые стили типографики

## Тесты:
- CSS переменные доступны в компонентах
- Компоненты используют переменные вместо хардкода
- StoryContent рендерится с правильными стилями

## Проверка:
- `task dev` - визуально улучшенная типографика
- Текст читаем на мобильном экране
- Отступы консистентны
- Chrome DevTools: CSS переменные применяются

## Критерий готовности:
Единая система стилей, читаемая типографика, переменные используются везде, тесты проходят.

Выведи все CSS файлы, обновленные компоненты и новый StoryContent.
```

---

## Prompt M1.4: Интеграция и проверка доступности

```text
Интегрируй все компоненты каркаса UI и проверь доступность приложения "ithappens".

## Контекст:
Созданы Layout, Navigation, базовые стили. Нужно собрать всё вместе и проверить a11y.

## Требования:
1. Обнови App.tsx для полной интеграции компонентов
2. Добавь заглушку для ID в header
3. Добавь StoryContent в main область
4. Проверь табуляцию и фокус клавиатурой
5. Добавь skip-to-content link для доступности
6. Настрой правильные ARIA landmarks

## Файлы для обновления:
- src/app.tsx (полная интеграция)
- src/app.module.css (стили для App)
- src/components/Layout/Layout.tsx (добавить skip link)
- src/components/SkipLink/SkipLink.tsx (новый компонент)
- src/components/SkipLink/SkipLink.module.css
- src/components/SkipLink/SkipLink.test.tsx

## Структура App с данными-заглушками:
```tsx
function App() {
  const [currentId] = useState(1)
  const storyText = "Пример текста истории...\n\nС несколькими параграфами..."
  
  return (
    <Layout
      header={<div>ID: {currentId}</div>}
      footer={<Navigation ... />}
    >
      <StoryContent text={storyText} />
    </Layout>
  )
}
```

## Требования доступности:
- Порядок табуляции: skip link → content → navigation
- Фокус виден визуально (focus outline)
- Landmarks: banner, main, contentinfo
- Кнопки доступны с клавиатуры
- Skip link скрыт визуально, но доступен для screen readers

## Тесты доступности:
- src/app.test.tsx:
  - Проверка наличия всех landmarks
  - Skip link присутствует и работает
  - Навигация с клавиатуры работает
  - Нет a11y violations (jest-axe)

## Добавь jest-axe для тестов:
```tsx
import { axe, toHaveNoViolations } from 'jest-axe'
expect.extend(toHaveNoViolations)

test('should have no accessibility violations', async () => {
  const { container } = render(<App />)
  const results = await axe(container)
  expect(results).toHaveNoViolations()
})
```

## Проверка:
- `task test` - все тесты включая a11y проходят
- `task dev` - полный UI каркас работает
- Tab навигация проходит по всем интерактивным элементам
- Screen reader (NVDA/JAWS) правильно читает структуру

## Критерий готовности:
Полный UI каркас собран, доступность проверена, навигация клавиатурой работает.

Выведи обновленный App, SkipLink компонент и тесты доступности.
```

---

## Prompt M1.5: Финальная полировка и оптимизация

```text
Заверши фазу M1 финальной полировкой UI каркаса приложения "ithappens".

## Контекст:
UI каркас создан, компоненты интегрированы, доступность проверена. Нужна финальная оптимизация.

## Задачи:
1. Добавь визуальные индикаторы состояний:
   - Loading state для будущей загрузки данных
   - Error boundary для обработки ошибок
   - Focus trap для будущего модального окна
2. Оптимизируй производительность:
   - Мемоизация компонентов где нужно
   - Lazy loading подготовка
3. Добавь мета-информацию:
   - Правильные meta теги в index.html
   - Viewport настройки для PWA
   - Theme color для браузера
4. Создай Storybook stories для компонентов (опционально)

## Файлы для создания/обновления:
- src/components/ErrorBoundary/ErrorBoundary.tsx
- src/components/ErrorBoundary/ErrorBoundary.test.tsx
- src/components/LoadingState/LoadingState.tsx
- src/components/LoadingState/LoadingState.module.css
- src/utils/performance.ts (утилиты для мемоизации)
- index.html (мета теги)

## ErrorBoundary требования:
```tsx
class ErrorBoundary extends Component {
  // Отлавливает ошибки в дочерних компонентах
  // Показывает fallback UI
  // Логирует ошибки (подготовка для production)
}
```

## LoadingState компонент:
- Минималистичный индикатор загрузки
- Текст "Инициализация..." без анимаций
- Центрирование по экрану

## Meta теги для index.html:
```html
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#ffffff">
<meta name="description" content="Читайте смешные истории офлайн">
<link rel="manifest" href="/manifest.json">
```

## Производительность:
- Использовать memo() для Navigation если props не меняются
- Подготовить lazy() импорты для будущих модалок
- Проверить re-renders в React DevTools

## Финальные тесты фазы M1:
- Все компоненты имеют тесты
- Coverage > 80% для компонентов
- Нет лишних re-renders
- Error boundary ловит ошибки
- Loading state отображается корректно

## Документация:
Обнови README.md с:
- Описанием структуры компонентов
- Архитектурными решениями
- Инструкцией по добавлению новых компонентов

## Проверка:
- `task check` - полная проверка проходит
- `task test:coverage` - покрытие > 80%
- Lighthouse audit - хорошие метрики для базового UI
- Визуальная проверка на разных размерах экрана

## Критерий готовности фазы M1:
UI каркас полностью готов, оптимизирован, протестирован. Готовы к добавлению данных в M2.

Выведи код новых компонентов, оптимизации и обновленную документацию.
```

---

## Prompt M1.6: Ревью и рефакторинг

```text
Проведи code review всей фазы M1 и выполни необходимый рефакторинг.

## Контекст:
Фаза M1 завершена. Нужно проверить качество кода и консистентность.

## Задачи code review:
1. Проверь консистентность:
   - Naming conventions везде одинаковые
   - Структура папок соответствует паттерну
   - Импорты используют алиасы (@/)
   - TypeScript типы строгие и полные
2. Проверь best practices:
   - Нет any типов
   - Props interfaces экспортируются
   - Компоненты имеют displayName
   - CSS классы в camelCase
3. Проверь тестовое покрытие:
   - Каждый компонент имеет тесты
   - Тесты проверяют поведение, не детали реализации
   - Используются правильные queries (getByRole и т.д.)
4. Оптимизация бандла:
   - Tree shaking работает
   - Нет неиспользуемого кода
   - CSS modules правильно обрабатываются

## Чеклист для проверки:
- [ ] Все компоненты типизированы
- [ ] Нет eslint warnings
- [ ] Prettier применен везде
- [ ] Тесты изолированы и быстрые
- [ ] CSS переменные используются консистентно
- [ ] Accessibility проверена
- [ ] Документация актуальна

## Рефакторинг если нужен:
1. Выдели общие типы в types/common.ts
2. Создай barrel exports для компонентов
3. Добавь JSDoc комментарии для публичных API
4. Оптимизируй импорты

## Создай сводный файл:
- src/components/index.ts (re-export всех компонентов)
- docs/components.md (документация компонентов)

## Метрики качества:
- Lighthouse Performance: > 90
- Lighthouse Accessibility: 100
- Test Coverage: > 80%
- Bundle Size: < 50KB (без stories.json)
- TypeScript strict: true

## Финальная структура src/:
```
src/
├── components/
│   ├── Layout/
│   ├── Navigation/
│   ├── StoryContent/
│   ├── ErrorBoundary/
│   ├── LoadingState/
│   ├── SkipLink/
│   └── index.ts
├── styles/
│   ├── variables.css
│   ├── reset.css
│   ├── typography.css
│   └── utilities.module.css
├── types/
│   ├── common.ts
│   └── navigation.ts
├── utils/
│   └── performance.ts
├── app.tsx
├── app.module.css
├── app.test.tsx
└── main.tsx
```

## Критерий завершения M1:
Code review пройден, рефакторинг выполнен, метрики качества достигнуты, готовы к M2.

Выведи результаты review, список изменений и финальные метрики.
```

---

## Метаданные для перехода к M2

### Что готово после M1:
- ✅ Полный UI каркас с тремя зонами
- ✅ Навигационные кнопки (без логики)
- ✅ Система стилей и типографика
- ✅ Доступность проверена
- ✅ Обработка ошибок настроена
- ✅ Тесты для всех компонентов

### Готовые интерфейсы для M2:
```typescript
// Эти интерфейсы уже созданы и будут использоваться в M2
interface NavigationProps {
  onPrevious: () => void
  onNext: () => void
  onJump: () => void
  canGoPrevious?: boolean
  canGoNext?: boolean
  currentId?: number
}

interface StoryContentProps {
  text: string
  isLoading?: boolean
}
```

### Подготовка для M2:
- Layout готов принимать динамический контент
- Navigation готова к подключению логики
- LoadingState готов для показа при загрузке данных
- ErrorBoundary готов ловить ошибки загрузки

### Следующие шаги в M2:
1. Добавление stories.json.sample
2. Создание storyService
3. Подключение данных к UI
4. Реализация навигации между историями

Каждый промпт M2 будет опираться на компоненты из M1, добавляя логику работы с данными без изменения структуры UI.